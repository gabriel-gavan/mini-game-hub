<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Minesweeper</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <!-- ‚úÖ AUTO ADS: keep ONLY this one AdSense loader -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5482914432517813"
    crossorigin="anonymous"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body{
      background:
        linear-gradient(135deg, rgba(0,0,0,0.82), rgba(15,23,42,0.92)),
        url("images/hub-bg.jpg") center center / cover no-repeat fixed;
      color:#e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height:100vh;
    }

    .layout{
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      padding:16px 8px;
      gap:12px;
    }

    .ad-vertical{
      width:160px;
      min-height:600px;
      border-radius:12px;
      border:1px dashed #1f2937;
      background: radial-gradient(circle at top, #020617 0, #020617 55%, #000 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      text-align:center;
      color:#6b7280;
      padding:8px;
    }

    .main-column{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
      width:100%;
      max-width:960px;
    }

    .top-banner{
      width:100%;
      max-width:960px;
      height:90px;
      border-radius:12px;
      border:1px dashed #1f2937;
      background: radial-gradient(circle at top, #020617 0, #020617 55%, #000 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:#6b7280;
      text-align:center;
      padding:4px;
    }

    .game-header{
      width:100%;
      max-width:960px;
      padding:0.55rem 1rem;
      border-radius:12px;
      border:1px solid #111827;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background: linear-gradient(135deg, #020617 0, #111827 40%, #0b1120 100%);
      font-size:0.9rem;
      gap:0.8rem;
      flex-wrap:wrap;
    }
    .game-header .title{ font-weight:800; letter-spacing:0.03em; display:flex; align-items:center; gap:10px; }
    .pill{
      font-size:0.72rem;
      padding:0.2rem 0.55rem;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.25);
      background: rgba(2,6,23,0.4);
      color:#cbd5e1;
    }
    .game-header a{
      color:#e5e7eb;
      text-decoration:none;
      font-size:0.85rem;
      padding:0.35rem 0.75rem;
      border-radius:999px;
      border:1px solid #374151;
      background: rgba(2,6,23,0.35);
    }
    .game-header a:hover{ border-color:#6366f1; }

    /* ---------- Frame like other games ---------- */
    .game-frame{
      width:100%;
      max-width:960px;
      border-radius:14px;
      border:1px solid #4b5563;
      background: radial-gradient(circle at top, #020617 0, #020617 55%, #000 100%);
      box-shadow: 0 20px 50px rgba(0,0,0,0.8);
      overflow:hidden;
      position:relative;
    }

    /* subtle ‚Äúastonishing‚Äù glow */
    .game-frame::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(700px 220px at 20% 0%, rgba(56,189,248,0.22), transparent 60%),
        radial-gradient(700px 220px at 80% 0%, rgba(99,102,241,0.20), transparent 60%),
        radial-gradient(600px 240px at 50% 100%, rgba(34,197,94,0.15), transparent 60%);
      pointer-events:none;
    }

    .game-inner{
      position:relative;
      padding:14px 14px 10px;
    }

    .hud{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.18);
      background: rgba(2,6,23,0.55);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    .hud-left{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }

    .select, .btn{
      height:38px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.28);
      background: rgba(2,6,23,0.65);
      color:#e5e7eb;
      padding:0 12px;
      font-weight:800;
      letter-spacing:0.02em;
      outline:none;
    }
    .select{ padding-right:34px; }
    .btn{
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,0.45);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ border-color: rgba(56,189,248,0.6); }
    .btn.flag{ border-color: rgba(250,204,21,0.55); }
    .btn.reset{ border-color: rgba(34,197,94,0.55); }

    .hud-right{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .stat{
      display:flex;
      gap:10px;
      align-items:center;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.18);
      background: rgba(2,6,23,0.45);
      font-size:0.9rem;
    }
    .stat b{ font-weight:900; }
    .hint{
      width:100%;
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.16);
      background: rgba(2,6,23,0.45);
      color:#cbd5e1;
      font-size:0.9rem;
      line-height:1.35;
    }

    /* ---------- Board ---------- */
    .board-wrap{
      margin-top:12px;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:10px 0 2px;
    }

    #board{
      display:grid;
      gap:6px;
      padding:10px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.18);
      background: rgba(2,6,23,0.35);
      box-shadow: inset 0 0 0 1px rgba(2,6,23,0.25);
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }

    .cell{
      width:38px;
      height:38px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.18);
      background: linear-gradient(180deg, rgba(17,24,39,0.95), rgba(2,6,23,0.85));
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      cursor:pointer;
      box-shadow:
        0 10px 18px rgba(0,0,0,0.35),
        inset 0 1px 0 rgba(255,255,255,0.06);
      transition: transform 0.06s ease, box-shadow 0.2s ease, background 0.2s ease;
    }
    .cell:active{ transform: translateY(1px); }

    .cell.open{
      cursor:default;
      background: rgba(31,41,55,0.75);
      box-shadow: inset 0 0 0 1px rgba(148,163,184,0.12);
      border-color: rgba(148,163,184,0.12);
    }

    .cell.flagged{
      border-color: rgba(250,204,21,0.35);
      box-shadow:
        0 10px 18px rgba(0,0,0,0.35),
        0 0 0 2px rgba(250,204,21,0.12),
        inset 0 1px 0 rgba(255,255,255,0.06);
    }

    .cell.mine{
      background: rgba(185,28,28,0.85);
      border-color: rgba(248,113,113,0.6);
      box-shadow: 0 0 26px rgba(248,113,113,0.35);
    }

    /* number colors */
    .n1{ color:#38bdf8; }
    .n2{ color:#22c55e; }
    .n3{ color:#f97316; }
    .n4{ color:#a855f7; }
    .n5{ color:#f43f5e; }
    .n6{ color:#14b8a6; }
    .n7{ color:#e5e7eb; }
    .n8{ color:#9ca3af; }

    /* ---------- Mobile controls below frame ---------- */
    .controls-below{
      width:100%;
      max-width:960px;
      display:none;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding:10px 6px 2px;
    }
    @media (max-width: 900px){
      .layout{ padding:8px; gap:0; }
      .ad-vertical{ display:none; }
      .top-banner{ height:60px; font-size:11px; }
      .game-header{ font-size:0.85rem; padding:0.5rem 0.7rem; }
      .game-header a{ font-size:0.8rem; padding:0.3rem 0.65rem; }
      .controls-below{ display:flex; }
      .cell{ width:34px; height:34px; border-radius:11px; }
      #board{ gap:5px; padding:9px; }
    }

    .mc-btn{
      touch-action:none;
      user-select:none;
      -webkit-user-select:none;
      height:56px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.35);
      background: rgba(2,6,23,0.65);
      color:#e5e7eb;
      font-weight:900;
      letter-spacing:0.02em;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 0 14px;
      box-shadow: 0 12px 26px rgba(0,0,0,0.55);
      opacity:0.97;
      cursor:pointer;
      min-width: 110px;
    }
    .mc-btn:active{ transform: translateY(1px); opacity:1; }
    .mc-btn.flag{ border-color: rgba(250,204,21,0.55); min-width: 128px; }
    .mc-btn.reset{ border-color: rgba(34,197,94,0.55); min-width: 128px; }
    .mc-btn.hint{ border-color: rgba(56,189,248,0.55); min-width: 130px; }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background: rgba(2,6,23,0.82);
      border:1px solid rgba(148,163,184,0.22);
      color:#e5e7eb;
      padding:10px 12px;
      border-radius:14px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.65);
      font-weight:800;
      letter-spacing:0.02em;
      display:none;
      z-index:999;
      max-width: 92vw;
      text-align:center;
    }
  </style>
</head>

<body>
<div class="layout">
  <!-- LEFT BANNER -->
  <aside class="ad-vertical">
    <div>
      Left Banner Zone<br/>
      <strong>160√ó600</strong><br/>
      Paste your AdSense code here.
    </div>
  </aside>

  <!-- MAIN COLUMN -->
  <main class="main-column">
    <!-- TOP LEADERBOARD -->
    <div class="top-banner">
      Top Banner Zone ‚Äì recommended 728√ó90 (auto also works).<br/>
      Paste your AdSense snippet here.
    </div>

    <!-- GAME HEADER -->
    <div class="game-header">
      <div class="title">üí£ Minesweeper <span class="pill" id="pillLevel">Beginner</span> <span class="pill" id="pillMode">Reveal</span></div>
      <div><a href="index.html">‚¨Ö Back to Hub</a></div>
    </div>

    <!-- GAME FRAME -->
    <div class="game-frame" role="region" aria-label="Minesweeper game frame">
      <div class="game-inner">
        <div class="hud">
          <div class="hud-left">
            <select class="select" id="difficultySelect" aria-label="Difficulty">
              <option value="beginner">Beginner (8√ó8, 10 mines)</option>
              <option value="intermediate">Intermediate (12√ó12, 24 mines)</option>
              <option value="expert">Expert (16√ó16, 50 mines)</option>
            </select>

            <button class="btn flag" id="btnToggleFlag" type="button" title="Toggle flag mode (F)">üö© Flag Mode</button>
            <button class="btn reset" id="btnRestart" type="button" title="Restart (R)">Restart</button>
          </div>

          <div class="hud-right">
            <div class="stat" title="Mines remaining (approx)">
              üí£ <b id="minesLeft">10</b>
            </div>
            <div class="stat" title="Flags placed">
              üö© <b id="flagsCount">0</b>
            </div>
            <div class="stat" title="Time">
              ‚è± <b id="time">0</b>s
            </div>
          </div>

          <div class="hint" id="status">
            Click a tile to reveal. Right-click (desktop) / long-press (mobile) to flag.
            Or toggle <b>Flag Mode</b> and tap tiles to place/remove flags.
          </div>
        </div>

        <div class="board-wrap">
          <div id="board" aria-label="Minesweeper board"></div>
        </div>
      </div>
    </div>

    <!-- ‚úÖ MOBILE CONTROLS BELOW THE GAME FRAME -->
    <div class="controls-below" aria-hidden="false">
      <button class="mc-btn hint" id="btnHelp" type="button">How to play</button>
      <button class="mc-btn flag" id="btnFlagMobile" type="button">üö© Flag: OFF</button>
      <button class="mc-btn reset" id="btnRestartMobile" type="button">Restart</button>
    </div>
  </main>

  <!-- RIGHT BANNER -->
  <aside class="ad-vertical">
    <div>
      Right Banner Zone<br/>
      <strong>160√ó600</strong><br/>
      Paste your AdSense code here.
    </div>
  </aside>
</div>

<div class="toast" id="toast"></div>

<script>
(() => {
  const boardEl = document.getElementById("board");
  const statusEl = document.getElementById("status");
  const difficultySelect = document.getElementById("difficultySelect");
  const btnRestart = document.getElementById("btnRestart");
  const btnRestartMobile = document.getElementById("btnRestartMobile");
  const btnToggleFlag = document.getElementById("btnToggleFlag");
  const btnFlagMobile = document.getElementById("btnFlagMobile");
  const btnHelp = document.getElementById("btnHelp");

  const minesLeftEl = document.getElementById("minesLeft");
  const flagsCountEl = document.getElementById("flagsCount");
  const timeEl = document.getElementById("time");
  const pillLevel = document.getElementById("pillLevel");
  const pillMode = document.getElementById("pillMode");
  const toastEl = document.getElementById("toast");

  const IS_MOBILE = (('ontouchstart' in window) || (navigator.maxTouchPoints > 0)) &&
                    window.matchMedia("(max-width: 900px)").matches;

  const LEVELS = {
    beginner:     { rows: 8,  cols: 8,  mines: 10 },
    intermediate: { rows: 12, cols: 12, mines: 24 },
    expert:       { rows: 16, cols: 16, mines: 50 }
  };

  let rows = 8, cols = 8, minesCount = 10;
  let board = [];
  let gameOver = false;
  let opened = 0;
  let flagsPlaced = 0;
  let flagMode = false;
  let started = false;
  let sec = 0;
  let tmr = null;

  function clamp(v, min, max){ return v < min ? min : v > max ? max : v; }

  function showToast(text){
    if (!toastEl) return;
    toastEl.textContent = text;
    toastEl.style.display = "block";
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toastEl.style.display = "none", 1800);
  }

  function setModeUI(){
    pillMode.textContent = flagMode ? "Flag" : "Reveal";
    btnToggleFlag.textContent = flagMode ? "üö© Flag Mode: ON" : "üö© Flag Mode";
    if (btnFlagMobile) btnFlagMobile.textContent = flagMode ? "üö© Flag: ON" : "üö© Flag: OFF";
  }

  function setLevelUI(key){
    const label =
      key === "beginner" ? "Beginner" :
      key === "intermediate" ? "Intermediate" : "Expert";
    pillLevel.textContent = label;
  }

  function stopTimer(){
    if (tmr) clearInterval(tmr);
    tmr = null;
  }

  function startTimer(){
    if (tmr) return;
    tmr = setInterval(() => {
      sec++;
      timeEl.textContent = String(sec);
    }, 1000);
  }

  function updateStats(){
    minesLeftEl.textContent = String(Math.max(0, minesCount - flagsPlaced));
    flagsCountEl.textContent = String(flagsPlaced);
  }

  function isInside(r,c){
    return r>=0 && r<rows && c>=0 && c<cols;
  }

  function neighbors(r,c){
    const out = [];
    for(let dr=-1; dr<=1; dr++){
      for(let dc=-1; dc<=1; dc++){
        if(dr===0 && dc===0) continue;
        const nr=r+dr, nc=c+dc;
        if(isInside(nr,nc)) out.push([nr,nc]);
      }
    }
    return out;
  }

  function computeCounts(){
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cell = board[r][c];
        if(cell.mine){ cell.count = 0; continue; }
        let total = 0;
        for(const [nr,nc] of neighbors(r,c)){
          if(board[nr][nc].mine) total++;
        }
        cell.count = total;
      }
    }
  }

  function placeMinesAvoiding(safeR, safeC){
    // place mines after first click so first cell is always safe
    let placed = 0;
    while(placed < minesCount){
      const r = Math.floor(Math.random()*rows);
      const c = Math.floor(Math.random()*cols);
      if ((r===safeR && c===safeC)) continue;
      const cell = board[r][c];
      if(!cell.mine){
        cell.mine = true;
        placed++;
      }
    }
    computeCounts();
  }

  function makeBoard(){
    board = [];
    for(let r=0;r<rows;r++){
      const row = [];
      for(let c=0;c<cols;c++){
        row.push({
          r, c,
          mine:false,
          open:false,
          flagged:false,
          count:0,
          el:null
        });
      }
      board.push(row);
    }
  }

  function buildDOM(){
    boardEl.innerHTML = "";
    boardEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

    // keep board nicely sized
    // (cells have fixed px size, so grid is natural)
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const d = document.createElement("div");
        d.className = "cell";
        d.setAttribute("role","button");
        d.setAttribute("aria-label", `Cell ${r+1},${c+1}`);

        // Left click / tap
        d.addEventListener("click", (e) => {
          e.preventDefault();
          if (IS_MOBILE) {
            // mobile uses flagMode or long-press
            if (flagMode) toggleFlag(r,c);
            else openCell(r,c);
          } else {
            if (flagMode) toggleFlag(r,c);
            else openCell(r,c);
          }
        });

        // Right click flag (desktop)
        d.addEventListener("contextmenu", (e) => {
          e.preventDefault();
          toggleFlag(r,c);
        });

        // Long-press flag (mobile)
        let lpTimer = null;
        d.addEventListener("pointerdown", (e) => {
          if (!IS_MOBILE) return;
          if (gameOver) return;
          lpTimer = setTimeout(() => {
            toggleFlag(r,c);
            showToast("üö© Flag toggled");
          }, 420);
        }, { passive:true });

        d.addEventListener("pointerup", () => { if (lpTimer) clearTimeout(lpTimer); lpTimer = null; }, { passive:true });
        d.addEventListener("pointercancel", () => { if (lpTimer) clearTimeout(lpTimer); lpTimer = null; }, { passive:true });

        board[r][c].el = d;
        boardEl.appendChild(d);
      }
    }
  }

  function revealAllMines(){
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cell = board[r][c];
        if(cell.mine){
          cell.el.classList.add("open","mine");
          cell.el.textContent = "üí£";
        }
      }
    }
  }

  function endGame(win){
    gameOver = true;
    stopTimer();

    if (win){
      statusEl.innerHTML = "üéâ <b>Clean sweep!</b> You cleared the sector.";
      showToast("‚úÖ Victory!");
      // flag remaining mines automatically (nice touch)
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const cell = board[r][c];
          if(cell.mine && !cell.flagged){
            cell.flagged = true;
            flagsPlaced++;
            cell.el.classList.add("flagged");
            cell.el.textContent = "üö©";
          }
        }
      }
      updateStats();
    } else {
      statusEl.innerHTML = "üí• <b>Boom.</b> You hit a mine. Restart and try again.";
      showToast("üí• Boom!");
      revealAllMines();
    }
  }

  function openCell(r,c){
    if(gameOver) return;
    const cell = board[r][c];
    if(cell.open || cell.flagged) return;

    if (!started){
      started = true;
      startTimer();
      placeMinesAvoiding(r,c);
    }

    cell.open = true;
    opened++;
    cell.el.classList.add("open");

    if(cell.mine){
      cell.el.classList.add("mine");
      cell.el.textContent = "üí£";
      endGame(false);
      return;
    }

    if(cell.count > 0){
      cell.el.textContent = String(cell.count);
      cell.el.classList.add("n" + String(clamp(cell.count,1,8)));
    } else {
      cell.el.textContent = "";
      // flood fill
      for(const [nr,nc] of neighbors(r,c)){
        const n = board[nr][nc];
        if(!n.open && !n.flagged) openCell(nr,nc);
      }
    }

    // win check
    const totalSafe = rows*cols - minesCount;
    if(opened >= totalSafe){
      endGame(true);
    }
  }

  function toggleFlag(r,c){
    if(gameOver) return;
    const cell = board[r][c];
    if(cell.open) return;

    if (!started){
      // allow flags before first open (common)
      started = true;
      startTimer();
      // mines are placed only on first open, not on first flag
      // (standard-ish). This keeps first reveal safe.
    }

    cell.flagged = !cell.flagged;
    if(cell.flagged){
      flagsPlaced++;
      cell.el.classList.add("flagged");
      cell.el.textContent = "üö©";
    } else {
      flagsPlaced = Math.max(0, flagsPlaced - 1);
      cell.el.classList.remove("flagged");
      cell.el.textContent = "";
    }
    updateStats();
  }

  function setDifficulty(key){
    const cfg = LEVELS[key] || LEVELS.beginner;
    rows = cfg.rows; cols = cfg.cols; minesCount = cfg.mines;
    setLevelUI(key);
    restart();
  }

  function restart(){
    stopTimer();
    sec = 0;
    timeEl.textContent = "0";
    gameOver = false;
    opened = 0;
    flagsPlaced = 0;
    started = false;

    statusEl.innerHTML = "Click a tile to reveal. Right-click / long-press to flag. Or use <b>Flag Mode</b>.";
    makeBoard();
    buildDOM();
    updateStats();
  }

  // ---------- Buttons / keys ----------
  function toggleFlagMode(){
    flagMode = !flagMode;
    setModeUI();
    showToast(flagMode ? "üö© Flag Mode ON" : "üü¶ Reveal Mode");
  }

  btnToggleFlag?.addEventListener("click", (e) => { e.preventDefault(); toggleFlagMode(); });
  btnFlagMobile?.addEventListener("click", (e) => { e.preventDefault(); toggleFlagMode(); });
  btnRestart?.addEventListener("click", (e) => { e.preventDefault(); restart(); });
  btnRestartMobile?.addEventListener("click", (e) => { e.preventDefault(); restart(); });

  btnHelp?.addEventListener("click", (e) => {
    e.preventDefault();
    showToast(IS_MOBILE
      ? "Tap to reveal ‚Ä¢ Long-press to flag ‚Ä¢ Or enable Flag Mode"
      : "Left-click reveal ‚Ä¢ Right-click flag ‚Ä¢ Or toggle Flag Mode (F)"
    );
  });

  difficultySelect?.addEventListener("change", () => {
    setDifficulty(difficultySelect.value);
  });

  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "r") restart();
    if (k === "f") toggleFlagMode();
    if (k === "escape") { flagMode = false; setModeUI(); showToast("Reveal Mode"); }
  });

  // ---------- Init ----------
  setModeUI();
  setDifficulty("beginner"); // default
})();
</script>

<script src="footer.js"></script>
</body>
</html>
