<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Starfall Squadron</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <!-- ✅ AUTO ADS: keep ONLY this one AdSense loader -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5482914432517813"
    crossorigin="anonymous"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background:
        linear-gradient(135deg, rgba(0,0,0,0.8), rgba(15,23,42,0.9)),
        url("images/hub-bg.jpg") center center / cover no-repeat fixed;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
    }

    .layout {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 16px 8px;
      gap: 12px;
    }

    .ad-vertical {
      width: 160px;
      min-height: 600px;
      border-radius: 12px;
      border: 1px dashed #1f2937;
      background: radial-gradient(circle at top, #020617 0, #020617 55%, #000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-align: center;
      color: #6b7280;
      padding: 8px;
    }

    .main-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      flex: 0 0 auto;
      width: 100%;
      max-width: 960px;
    }

    .top-banner {
      width: 100%;
      max-width: 960px;
      height: 90px;
      border-radius: 12px;
      border: 1px dashed #1f2937;
      background: radial-gradient(circle at top, #020617 0, #020617 55%, #000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #6b7280;
      text-align: center;
      padding: 4px;
    }

    .game-header {
      width: 100%;
      max-width: 960px;
      padding: 0.55rem 1.0rem;
      border-radius: 12px;
      border: 1px solid #111827;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, #020617 0, #111827 40%, #0b1120 100%);
      font-size: 0.9rem;
      gap: 0.8rem;
      flex-wrap: wrap;
    }
    .game-header .title { font-weight: 700; letter-spacing: 0.03em; }
    .game-header a {
      color: #e5e7eb;
      text-decoration: none;
      font-size: 0.85rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px solid #374151;
      background: rgba(2,6,23,0.35);
    }
    .game-header a:hover { border-color: #6366f1; }

    .game-wrap { position: relative; width: 100%; max-width: 960px; }

    canvas {
      border-radius: 14px;
      border: 1px solid #4b5563;
      background: radial-gradient(circle at top, #020617 0, #020617 55%, #000 100%);
      box-shadow: 0 20px 50px rgba(0,0,0,0.8);
      width: 100%;
      height: auto;
      cursor: crosshair;
      display: block;

      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
    }

    @media (max-width: 900px) {
      .layout { padding: 8px; gap: 0; }
      .ad-vertical { display: none; }
      .top-banner { height: 60px; font-size: 11px; }
      .game-header { font-size: 0.85rem; padding: 0.5rem 0.7rem; }
      .game-header a { font-size: 0.8rem; padding: 0.3rem 0.65rem; }
    }

    /* =========================
       MOBILE CONTROLS (below)
       ========================= */
    .controls-below {
      width: 100%;
      max-width: 960px;
      display: none;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      padding: 10px 6px 2px;
      pointer-events: auto;
    }

    @media (max-width: 900px) {
      .controls-below { display: flex; }
    }

    .mc-joystick {
      width: 140px;
      height: 140px;
      border-radius: 999px;
      background: rgba(2,6,23,0.55);
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 12px 28px rgba(0,0,0,0.55);
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
      position: relative;
      flex: 0 0 auto;
    }

    .mc-joystick::after {
      content: "";
      position: absolute;
      inset: 18px;
      border-radius: 999px;
      border: 1px dashed rgba(148,163,184,0.25);
    }

    .mc-knob {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 54px;
      height: 54px;
      transform: translate(-50%, -50%);
      border-radius: 999px;
      background: rgba(56,189,248,0.25);
      border: 1px solid rgba(56,189,248,0.55);
      box-shadow: 0 10px 18px rgba(0,0,0,0.5);
      pointer-events: none;
    }

    .mc-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: flex-end;
      flex: 1 1 auto;
    }

    .mc-btn {
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
      width: 140px;
      height: 56px;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.35);
      background: rgba(2,6,23,0.65);
      color: #e5e7eb;
      font-weight: 900;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 26px rgba(0,0,0,0.55);
      opacity: 0.97;
    }
    .mc-btn:active { transform: translateY(1px); opacity: 1; }
    .mc-btn.fire { border-color: rgba(56,189,248,0.65); }
    .mc-btn.pause { border-color: rgba(34,197,94,0.55); width: 96px; }

    @media (max-width: 420px) {
      .mc-joystick { width: 126px; height: 126px; }
      .mc-btn { width: 132px; height: 54px; }
      .mc-btn.pause { width: 92px; }
    }
  </style>
</head>

<body>
<div class="layout">
  <!-- LEFT BANNER -->
  <aside class="ad-vertical">
    <div>
      Left Banner Zone<br/>
      <strong>160×600</strong><br/>
      Paste your AdSense code here.
    </div>
  </aside>

  <!-- MAIN COLUMN -->
  <main class="main-column">
    <!-- TOP LEADERBOARD -->
    <div class="top-banner">
      Top Banner Zone – recommended 728×90 (auto also works).<br/>
      Paste your AdSense snippet here.
    </div>

    <!-- GAME HEADER -->
    <div class="game-header">
      <div class="title">Starfall Squadron</div>
      <div><a href="index.html">⬅ Back to Hub</a></div>
    </div>

    <!-- GAME CANVAS -->
    <div class="game-wrap">
      <canvas id="gameCanvas" width="960" height="540"></canvas>
    </div>

    <!-- ✅ MOBILE CONTROLS BELOW THE GAME FRAME (NO DASH) -->
    <div class="controls-below" id="controlsBelow" aria-hidden="true">
      <div class="mc-joystick" id="joyBase" aria-label="Move joystick">
        <div class="mc-knob" id="joyKnob"></div>
      </div>

      <div class="mc-actions">
        <button class="mc-btn pause" id="btnPause" type="button">⏸</button>
        <button class="mc-btn fire" id="btnFire" type="button">FIRE</button>
      </div>
    </div>
  </main>

  <!-- RIGHT BANNER -->
  <aside class="ad-vertical">
    <div>
      Right Banner Zone<br/>
      <strong>160×600</strong><br/>
      Paste your AdSense code here.
    </div>
  </aside>
</div>

<script>
(() => {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;

  // ========= INPUT + MOBILE CONTROLS (below canvas) =========
  const keys = {};
  const IS_MOBILE = (('ontouchstart' in window) || (navigator.maxTouchPoints > 0)) &&
                    window.matchMedia("(max-width: 900px)").matches;

  const controlsBelow = document.getElementById("controlsBelow");
  const joyBase = document.getElementById("joyBase");
  const joyKnob = document.getElementById("joyKnob");
  const btnFire = document.getElementById("btnFire");
  const btnPause = document.getElementById("btnPause");

  if (controlsBelow) controlsBelow.style.display = IS_MOBILE ? "flex" : "none";

  const virtual = { joyX: 0, joyY: 0, fireHeld: false, fireQueued: false };

  let joyActive = false;
  let joyPointerId = null;
  let joyCenter = { x: 0, y: 0 };
  const joyMax = 44;

  function clamp(v, min, max) { return v < min ? min : v > max ? max : v; }

  function setKnob(dx, dy) {
    if (!joyKnob) return;
    joyKnob.style.transform = `translate(${dx}px, ${dy}px) translate(-50%, -50%)`;
  }
  function resetJoystick() {
    virtual.joyX = 0;
    virtual.joyY = 0;
    joyActive = false;
    joyPointerId = null;
    setKnob(0, 0);
  }
  function getJoyCenter() {
    const r = joyBase.getBoundingClientRect();
    joyCenter = { x: r.left + r.width / 2, y: r.top + r.height / 2 };
  }
  function onJoyMove(clientX, clientY) {
    const dx = clientX - joyCenter.x;
    const dy = clientY - joyCenter.y;
    const clampedDx = clamp(dx, -joyMax, joyMax);
    const clampedDy = clamp(dy, -joyMax, joyMax);
    virtual.joyX = clamp(clampedDx / joyMax, -1, 1);
    virtual.joyY = clamp(clampedDy / joyMax, -1, 1);
    setKnob(clampedDx, clampedDy);
  }

  if (joyBase) {
    joyBase.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      joyBase.setPointerCapture(e.pointerId);
      joyActive = true;
      joyPointerId = e.pointerId;
      getJoyCenter();
      onJoyMove(e.clientX, e.clientY);
    }, { passive: false });

    joyBase.addEventListener("pointermove", (e) => {
      if (!joyActive || e.pointerId !== joyPointerId) return;
      e.preventDefault();
      onJoyMove(e.clientX, e.clientY);
    }, { passive: false });

    joyBase.addEventListener("pointerup", (e) => {
      if (e.pointerId !== joyPointerId) return;
      e.preventDefault();
      resetJoystick();
    }, { passive: false });

    joyBase.addEventListener("pointercancel", (e) => {
      if (e.pointerId !== joyPointerId) return;
      e.preventDefault();
      resetJoystick();
    }, { passive: false });
  }

  if (btnFire) {
    btnFire.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      virtual.fireHeld = true;
      virtual.fireQueued = true;
      btnFire.setPointerCapture(e.pointerId);
    }, { passive: false });

    btnFire.addEventListener("pointerup", (e) => {
      e.preventDefault();
      virtual.fireHeld = false;
    }, { passive: false });

    btnFire.addEventListener("pointercancel", (e) => {
      e.preventDefault();
      virtual.fireHeld = false;
    }, { passive: false });
  }

  const game = { state: "menu" };

  if (btnPause) {
    btnPause.addEventListener("click", (e) => {
      e.preventDefault();
      if (game.state === "playing") game.state = "paused";
      else if (game.state === "paused") game.state = "playing";
    });
  }

  window.addEventListener("keydown", (e) => {
    keys[e.key.toLowerCase()] = true;

    if (e.key === "p" || e.key === "P") {
      if (game.state === "playing") game.state = "paused";
      else if (game.state === "paused") game.state = "playing";
    }

    if (e.key === "enter") {
      if (game.state === "menu" || game.state === "gameover") startRun();
    }
  });

  window.addEventListener("keyup", (e) => { keys[e.key.toLowerCase()] = false; });

  // Tap on canvas: start / fire
  let pDown = false, pStartX = 0, pStartY = 0, pMoved = false;

  canvas.addEventListener("pointerdown", (e) => {
    pDown = true; pMoved = false;
    pStartX = e.clientX; pStartY = e.clientY;
    canvas.setPointerCapture(e.pointerId);
    e.preventDefault();
  }, { passive: false });

  canvas.addEventListener("pointermove", (e) => {
    if (!pDown) return;
    if (Math.hypot(e.clientX - pStartX, e.clientY - pStartY) > 10) pMoved = true;
    e.preventDefault();
  }, { passive: false });

  canvas.addEventListener("pointerup", (e) => {
    if (!pDown) return;
    pDown = false;

    if (!pMoved) {
      if (game.state === "menu" || game.state === "gameover") startRun();
      else if (game.state === "playing") {
        virtual.fireQueued = true;
      }
    }
    e.preventDefault();
  }, { passive: false });

  canvas.addEventListener("pointercancel", () => { pDown = false; });

  // ========= SIMPLE STARFALL GAME (placeholder engine) =========
  // NOTE: this keeps your requested UI change consistent.
  // If you paste your existing Starfall Squadron game logic here,
  // keep the controls section above and remove any DASH button logic.

  const ship = { x: 120, y: HEIGHT/2, w: 46, h: 28, vx: 0, vy: 0, speed: 360, hp: 100 };
  const bullets = [];
  const asteroids = [];
  let spawnT = 0;
  let score = 0;

  function lerp(a, b, t) { return a + (b - a) * t; }

  function startRun() {
    game.state = "playing";
    ship.x = 120; ship.y = HEIGHT/2; ship.vx = 0; ship.vy = 0; ship.hp = 100;
    bullets.length = 0;
    asteroids.length = 0;
    spawnT = 0;
    score = 0;
  }

  function fire() {
    bullets.push({ x: ship.x + ship.w, y: ship.y + ship.h/2, vx: 820, r: 3 });
  }

  function rectsOverlap(a, b) {
    return (a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y);
  }

  function update(dt) {
    if (game.state === "paused") return;

    if (game.state !== "playing") return;

    // movement: keyboard + joystick
    let mx = 0, my = 0;
    if (keys["arrowleft"] || keys["a"]) mx -= 1;
    if (keys["arrowright"] || keys["d"]) mx += 1;
    if (keys["arrowup"] || keys["w"]) my -= 1;
    if (keys["arrowdown"] || keys["s"]) my += 1;

    mx += virtual.joyX; my += virtual.joyY;
    mx = clamp(mx, -1, 1); my = clamp(my, -1, 1);

    ship.vx = lerp(ship.vx, mx * ship.speed, 0.16);
    ship.vy = lerp(ship.vy, my * ship.speed, 0.16);
    ship.x += ship.vx * dt;
    ship.y += ship.vy * dt;

    ship.x = clamp(ship.x, 0, WIDTH - ship.w);
    ship.y = clamp(ship.y, 60, HEIGHT - ship.h);

    // fire: space or FIRE button
    const wantFire = keys[" "] || keys["k"];
    if (wantFire || virtual.fireQueued) {
      fire();
      virtual.fireQueued = false;
    }

    // bullets
    for (let i = bullets.length - 1; i >= 0; i--) {
      bullets[i].x += bullets[i].vx * dt;
      if (bullets[i].x > WIDTH + 40) bullets.splice(i, 1);
    }

    // spawn asteroids
    spawnT -= dt;
    if (spawnT <= 0) {
      spawnT = 0.45 + Math.random() * 0.55;
      const r = 14 + Math.random() * 26;
      asteroids.push({
        x: WIDTH + 40, y: 80 + Math.random() * (HEIGHT - 140),
        w: r * 2, h: r * 2,
        vx: -(220 + Math.random() * 220),
        r
      });
    }

    // asteroids + collisions
    for (let i = asteroids.length - 1; i >= 0; i--) {
      const a = asteroids[i];
      a.x += a.vx * dt;

      // ship hit
      if (rectsOverlap({x:ship.x, y:ship.y, w:ship.w, h:ship.h}, {x:a.x, y:a.y, w:a.w, h:a.h})) {
        ship.hp -= 30;
        asteroids.splice(i, 1);
        if (ship.hp <= 0) game.state = "gameover";
        continue;
      }

      // bullet hit
      let destroyed = false;
      for (let j = bullets.length - 1; j >= 0; j--) {
        const b = bullets[j];
        const br = { x: b.x - b.r, y: b.y - b.r, w: b.r*2, h: b.r*2 };
        if (rectsOverlap(br, {x:a.x, y:a.y, w:a.w, h:a.h})) {
          bullets.splice(j, 1);
          asteroids.splice(i, 1);
          score += 10;
          destroyed = true;
          break;
        }
      }
      if (destroyed) continue;

      if (a.x < -80) asteroids.splice(i, 1);
    }
  }

  function drawBackground() {
    ctx.fillStyle = "#020617";
    ctx.fillRect(0, 0, WIDTH, HEIGHT);

    // stars
    ctx.globalAlpha = 0.55;
    for (let i = 0; i < 120; i++) {
      const x = (i * 97.3 + performance.now() * 0.02) % WIDTH;
      const y = (i * 53.1) % HEIGHT;
      ctx.fillRect(x, y, 1, 1);
    }
    ctx.globalAlpha = 1;

    // top HUD band
    ctx.fillStyle = "rgba(15,23,42,0.88)";
    ctx.fillRect(0, 0, WIDTH, 60);
  }

  function draw() {
    drawBackground();

    // HUD
    ctx.fillStyle = "#e5e7eb";
    ctx.font = "13px system-ui";
    ctx.textBaseline = "top";
    ctx.fillText(`HP: ${ship.hp}`, 16, 10);
    ctx.fillText(`Score: ${score}`, 16, 28);

    ctx.textAlign = "right";
    ctx.fillText(
      IS_MOBILE ? "Move: Joystick below · Fire: FIRE / tap · Pause: ⏸" : "Move: WASD/Arrows · Fire: Space · Pause: P",
      WIDTH - 16, 18
    );
    ctx.textAlign = "left";

    // ship
    ctx.fillStyle = "#0f172a";
    ctx.strokeStyle = "#38bdf8";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.roundRect(ship.x, ship.y, ship.w, ship.h, 8);
    ctx.fill(); ctx.stroke();

    ctx.fillStyle = "#38bdf8";
    ctx.fillRect(ship.x + ship.w - 10, ship.y + 8, 6, 12);

    // bullets
    ctx.fillStyle = "#e5e7eb";
    for (const b of bullets) {
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
      ctx.fill();
    }

    // asteroids
    ctx.fillStyle = "#111827";
    ctx.strokeStyle = "#f97316";
    for (const a of asteroids) {
      ctx.beginPath();
      ctx.arc(a.x + a.r, a.y + a.r, a.r, 0, Math.PI * 2);
      ctx.fill(); ctx.stroke();
    }

    // overlays
    if (game.state === "menu" || game.state === "gameover" || game.state === "paused") {
      ctx.fillStyle = "rgba(15,23,42,0.75)";
      ctx.fillRect(0, 0, WIDTH, HEIGHT);

      ctx.fillStyle = "#e5e7eb";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      const cx = WIDTH / 2, cy = HEIGHT / 2;

      if (game.state === "menu") {
        ctx.font = "32px system-ui";
        ctx.fillText("STARFALL SQUADRON", cx, cy - 40);
        ctx.font = "15px system-ui";
        ctx.fillText(IS_MOBILE ? "Joystick below + FIRE" : "WASD + Space", cx, cy + 4);
        ctx.font = "13px system-ui";
        ctx.fillStyle = "#9ca3af";
        ctx.fillText(IS_MOBILE ? "Tap to start" : "Press ENTER to start", cx, cy + 40);
      } else if (game.state === "paused") {
        ctx.font = "26px system-ui";
        ctx.fillStyle = "#e5e7eb";
        ctx.fillText("PAUSED", cx, cy);
        ctx.font = "13px system-ui";
        ctx.fillStyle = "#9ca3af";
        ctx.fillText(IS_MOBILE ? "Tap ⏸ to resume" : "Press P to resume", cx, cy + 30);
      } else {
        ctx.font = "28px system-ui";
        ctx.fillStyle = "#f97373";
        ctx.fillText("SQUADRON DOWN", cx, cy - 20);
        ctx.font = "14px system-ui";
        ctx.fillStyle = "#e5e7eb";
        ctx.fillText(`Score: ${score}`, cx, cy + 14);
        ctx.font = "13px system-ui";
        ctx.fillStyle = "#9ca3af";
        ctx.fillText(IS_MOBILE ? "Tap to retry" : "Press ENTER to retry", cx, cy + 44);
      }

      ctx.textAlign = "left";
      ctx.textBaseline = "top";
    }
  }

  let last = performance.now();
  function loop(t) {
    const dt = Math.min(0.033, (t - last) / 1000);
    last = t;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
})();
</script>

<script src="footer.js"></script>
</body>
</html>
